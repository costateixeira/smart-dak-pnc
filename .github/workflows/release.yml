name: Release build

on:
  release:            # catches all release events; or use `types: [published]`
  workflow_dispatch:

permissions:
  contents: write     # needed so the CALLED workflow can push to gh-pages

jobs:
  check:
    runs-on: ubuntu-latest
    outputs:
      file_exists: ${{ steps.checkfile.outputs.exists }}
    steps:
      - name: Echo starting
        run: echo "âœ… IG release workflow triggered successfully"

      - name: Checkout code
        uses: actions/checkout@v4
        with:
          # On release: use the tag; otherwise use the ref selected in the UI
          ref: ${{ github.event_name == 'release' && github.event.release.tag_name || github.ref }}
          fetch-depth: 0

      - name: Check for publication-request.json
        id: checkfile
        run: |
          if [[ -f "publication-request.json" ]]; then
            echo "exists=true" >> "$GITHUB_OUTPUT"
          else
            echo "exists=false" >> "$GITHUB_OUTPUT"
          fi

  trigger:
    # Uncomment if you want to require the file:
    # needs: check
    # if: needs.check.outputs.file_exists == 'true'
    uses: costateixeira/smart-html/.github/workflows/release.yml@main
    secrets: inherit     # include if the called workflow needs repo secrets
